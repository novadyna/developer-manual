<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Li Gangwei, Louis Lor">
        <link rel="canonical" href="https://nova35.gitlab.io/novaweb/v2/developer-manual/environments/qol.html">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Deployment QOL - Nova Developer Manual</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../index.html">Nova Developer Manual</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../index.html" class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Introduction</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../intro/domains.html" class="dropdown-item">Domains</a>
</li>
                                    
<li>
    <a href="../intro/repos.html" class="dropdown-item">Repositories</a>
</li>
                                    
<li>
    <a href="../intro/repo-migration.html" class="dropdown-item">Migrating Repositories</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Backend</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Deployment Procedures(Backend)</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../backend/deployment/prerequisites.html" class="dropdown-item">Prerequisites</a>
</li>
            
<li>
    <a href="../backend/deployment/deployment.html" class="dropdown-item">Deployment</a>
</li>
            
<li>
    <a href="../backend/deployment/post-deploy.html" class="dropdown-item">Post Deploy Setup</a>
</li>
            
<li>
    <a href="../backend/deployment/faqs.html" class="dropdown-item">FAQs</a>
</li>
    </ul>
  </li>
                                    
<li>
    <a href="../backend/serverless-intro.html" class="dropdown-item">Introduction to the Serverless Framework</a>
</li>
                                    
<li>
    <a href="../backend/codebase-intro.html" class="dropdown-item">Introduction to the Nova Codebase(Backend)</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Data Deep Dive</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../backend/deepdive/dynamo-basics.html" class="dropdown-item">DynamoDB Basics</a>
</li>
            
<li>
    <a href="../backend/deepdive/database-structure.html" class="dropdown-item">Nova's Database Structure</a>
</li>
            
<li>
    <a href="../backend/deepdive/data-schema.html" class="dropdown-item">Data Schema</a>
</li>
            
<li>
    <a href="../backend/deepdive/storage-classes.html" class="dropdown-item">Storage Classes</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Analytics</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../backend/analytics/intro.html" class="dropdown-item">Intro</a>
</li>
            
<li>
    <a href="../backend/analytics/heartbeats.html" class="dropdown-item">Heartbeats</a>
</li>
            
<li>
    <a href="../backend/analytics/redis-data-usage.html" class="dropdown-item">Redis Data Usage</a>
</li>
            
<li>
    <a href="../backend/analytics/aggregation.html" class="dropdown-item">Aggregation</a>
</li>
            
<li>
    <a href="../backend/analytics/metrics.html" class="dropdown-item">Metrics</a>
</li>
            
<li>
    <a href="../backend/analytics/issues.html" class="dropdown-item">Issues</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Frontend</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../frontend/prerequisites.html" class="dropdown-item">Prerequisites</a>
</li>
                                    
<li>
    <a href="../frontend/admin-panel.html" class="dropdown-item">Admin Panel</a>
</li>
                                    
<li>
    <a href="../frontend/event-viewer.html" class="dropdown-item">Event Viewer</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Extensions</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../frontend/extension-poll.html" class="dropdown-item">Poll</a>
</li>
            
<li>
    <a href="../frontend/extension-survey.html" class="dropdown-item">Survey</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Deployment Environments</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="intro.html" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="deployment.html" class="dropdown-item">Deployment Procedures(Environments)</a>
</li>
                                    
<li>
    <a href="qol.html" class="dropdown-item active" aria-current="page">Deployment QOL</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Jenkins</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../jenkins/intro.html" class="dropdown-item">Introduction</a>
</li>
                                    
<li>
    <a href="../jenkins/management.html" class="dropdown-item">Managing Jenkins</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="deployment.html" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../jenkins/intro.html" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="2"><a href="#deployment-qol" class="nav-link">Deployment QOL</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="deployment-qol">Deployment QOL</h2>
<hr />
<h3 id="automation">Automation</h3>
<p>Since we have 7 api projects and 4 site project(so far).</p>
<p>Merging and deploying 11 projects everytime a deployment is made, not to mention having to properly
remember and manage different env secrets, giving the proper cli stage variables, is not only
tiresome, it's also prone to human errors.</p>
<p>Therefore, for deployment, we have a <a href="https://jenkins.novaweb.live/" target="_blank">Jenkins</a> CICD
server at our disposal.</p>
<p>The details of our Jenkins server will be in another chapter.</p>
<p>Our Jenkins home page should look like this(after login):</p>
<p><img alt="Screenshot" src="../assets/jenkins-home.png" style="height:auto;width:auto" /></p>
<p>Depending on your level of access, what you see may differ from this.</p>
<p>Navigate into a stage's folder, we'll take <code>sandbox</code> for instance:</p>
<p><img alt="img.png" src="../assets/jenkins-sandbox.png" style="height:auto;width:auto" /></p>
<p>And then press the play button on the project you wish to deploy:</p>
<p><img alt="img.png" src="../assets/sandbox-deploy-button.png" style="height:auto;width:auto" /></p>
<p>It will copy the necessary env files over, together with api secrets for third party apis, install
required modules and deploy for you.</p>
<p>The script it runs looks a bit like this:</p>
<pre><code class="language-shell">npm install

cp ~/nova-env/.env.&lt;STAGE&gt;.json $WORKSPACE/
cp ~/nova-env/.secrets.&lt;STAGE&gt;.json $WORKSPACE/

sls deploy --stage &lt;STAGE&gt; --profile default
</code></pre>
<p>Jobs can run concurrently, meaning you can safely press play on all 11 projects, and patiently let
it do its job.</p>
<p>Deployments are also done from their respective branch, therefore <code>sandbox</code> and <code>prod</code> deployments
should to an extent be idempotent.</p>
<h3 id="recommended-shell-scripts-to-have">Recommended shell Scripts to Have</h3>
<p>Even with the help of Jenkins, managing 11 git repositories is still somewhat a cognitively
demanding operation. Therefore, it is recommended to have a number of local bash scripts that can
help with your everyday tasks.</p>
<ul>
<li>Copies env files from server<ul>
<li>Our envs are stored on the jenkins instance, if you have ssh access, you can conveniently copy
  them to your local environment with <code>scp</code></li>
<li>example(all examples are in batch(windows)):</li>
</ul>
</li>
</ul>
<pre><code class="language-bat">echo off

scp &lt;server_domain&gt;:~/nova-env/.env.*.json ./
scp &lt;server_domain&gt;:~/nova-env/.secrets.*.json ./

for /D %%i in (&quot;*&quot;) do (
    xcopy .env.*.json %~dp0\%%i\ /Y
    xcopy .secrets.*.json %~dp0\%%i\ /Y
)

pause
</code></pre>
<ul>
<li>Merge current <code>master</code> to <code>sandbox</code><ul>
<li>This will be done about once a week, so it's immensely helpful if you don't need to merge and
  push all 11 projects manually</li>
<li>Example: (in batch)</li>
</ul>
</li>
</ul>
<pre><code class="language-bat">echo off

for /D %%i in (&quot;*&quot;) do (
    cd %~dp0%%i
    call git switch master --recurse-submodules --discard-changes
    call git pull --ff-only
    call git submodule update --init --recursive
    call git switch sandbox --recurse-submodules --discard-changes
    call git merge master --ff-only
    call git push
    call git switch master --recurse-submodules --discard-changes
)

pause
</code></pre>
<ul>
<li>
<p>Merge current <code>sandbox</code> to <code>prod</code></p>
<ul>
<li>This one goes without saying</li>
</ul>
</li>
<li>
<p>Update all submodules to the latest</p>
<ul>
<li>This is not done very frequently, usually submodule\ versions are managed per projects, since
  every project is usually on a different submodule version, but on the rare occasions that you
  made substantial updates to the submodule and is updating submodules for all api projects
  frequently(a couple times a day), this is immensely helpful. </li>
</ul>
</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
